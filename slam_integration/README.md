# SLAMé›†æˆæ¨¡å— - Brainé¡¹ç›®

## ğŸ“‹ æ¦‚è¿°

æœ¬æ¨¡å—ä¸ºBrainè®¤çŸ¥å±‚æä¾›ç»Ÿä¸€çš„SLAMï¼ˆåŒæ­¥å®šä½ä¸åœ°å›¾æ„å»ºï¼‰é›†æˆæ¥å£ï¼Œæ”¯æŒå¤šç§SLAMåç«¯ç³»ç»Ÿã€‚

### æ ¸å¿ƒç‰¹æ€§

- âœ… **ç»Ÿä¸€æ¥å£**: æ”¯æŒFAST-LIVOã€LIO-SAMã€Cartographerç­‰å¤šç§SLAMåç«¯
- âœ… **é›¶æ‹·è´å¼•ç”¨**: ç›´æ¥å¼•ç”¨SLAMåœ°å›¾ï¼Œé¿å…æ•°æ®å¤åˆ¶ï¼Œæå‡æ€§èƒ½
- âœ… **åæ ‡ç³»ç»Ÿä¸€**: TF2åæ ‡å˜æ¢ï¼Œç»Ÿä¸€mapã€odomã€base_linkç­‰åæ ‡ç³»
- âœ… **åœºæ™¯è‡ªé€‚åº”**: æ”¯æŒå®¤å†…ã€å®¤å¤–ã€æ··åˆç¯å¢ƒçš„SLAMå‚æ•°è‡ªé€‚åº”
- âœ… **æ··åˆåœ°å›¾ç®¡ç†**: å‡ ä½•å±‚ï¼ˆSLAMï¼‰+ è¯­ä¹‰å±‚ï¼ˆVLMï¼‰+ å› æœå±‚ï¼ˆè®¤çŸ¥æ¨ç†ï¼‰

### æ¶æ„è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Brain ç³»ç»Ÿæ¶æ„                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚        SLAMå±‚ (FAST-LIVO / LIO-SAM)            â”‚    â”‚
â”‚  â”‚  è¾“å…¥: LiDAR + IMU + Camera                      â”‚    â”‚
â”‚  â”‚  è¾“å‡º: å…¨å±€ä¸€è‡´çš„åœ°å›¾ + ç²¾ç¡®ä½å§¿                  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                      â†“                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚      SLAM Manager (slam_manager.py)             â”‚    â”‚
â”‚  â”‚  - è®¢é˜…SLAMåœ°å›¾å’Œä½å§¿ï¼ˆé›¶æ‹·è´ï¼‰                   â”‚    â”‚
â”‚  â”‚  - åæ ‡è½¬æ¢ (world â†” grid)                       â”‚    â”‚
â”‚  â”‚  - å¼‚æ­¥åœ°å›¾æ›´æ–°                                  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                      â†“                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚            è®¤çŸ¥å±‚ (WorldModel)                  â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚    â”‚
â”‚  â”‚  â”‚  å‡ ä½•å±‚ (SLAMåœ°å›¾å¼•ç”¨ - é›¶æ‹·è´)          â”‚   â”‚    â”‚
â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚    â”‚
â”‚  â”‚  â”‚  è¯­ä¹‰å±‚ (VLMç‰©ä½“ + è®¤çŸ¥æ ‡æ³¨)             â”‚   â”‚    â”‚
â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚    â”‚
â”‚  â”‚  â”‚  å› æœå±‚ (æ¨ç†å’Œå…³ç³»)                     â”‚   â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                      â†“                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚               è§„åˆ’å±‚                             â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒå‡†å¤‡

#### ROS2å®‰è£…

ç¡®ä¿å·²å®‰è£…ROS2ï¼ˆæ¨èGalacticæˆ–Humbleï¼‰ï¼š

```bash
# æ£€æŸ¥ROS2æ˜¯å¦å®‰è£…
which ros2

# æŸ¥çœ‹ROS2ç‰ˆæœ¬
ros2 --version
```

#### Pythonä¾èµ–

```bash
cd /media/yangyuhui/CODES1/Brain
pip install -r requirements.txt
```

### 2. SLAMåç«¯é€‰æ‹©

#### æ–¹æ¡ˆA: FAST-LIVOï¼ˆæ¨èï¼‰

é€‚åˆæ··åˆç¯å¢ƒï¼ˆå®¤å†…+å®¤å¤–ï¼‰ï¼Œè§†è§‰-æ¿€å…‰-IMUç´§è€¦åˆã€‚

```bash
# å…‹éš†FAST-LIVOæºç 
cd ~/ros2_ws/src
git clone https://github.com/hku-mars/FAST-LIVO.git

# å®‰è£…ä¾èµ–
cd ~/ros2_ws
rosdep install --from-paths src --ignore-src -r -y

# ç¼–è¯‘
colcon build --packages-select fast_livo

# é…ç½®ç¯å¢ƒ
source install/setup.bash
```

#### æ–¹æ¡ˆB: LIO-SAMï¼ˆå¤‡é€‰ï¼‰

é€‚åˆæ¿€å…‰é›·è¾¾SLAMï¼Œæˆç†Ÿç¨³å®šã€‚

```bash
cd ~/ros2_ws/src
git clone https://github.com/TixiaoShan/LIO-SAM.git

# å®‰è£…ä¾èµ–å¹¶ç¼–è¯‘
# ...
```

#### æ–¹æ¡ˆC: slam_toolboxï¼ˆç®€å•ï¼‰

ROS2å®˜æ–¹SLAMåŒ…ï¼Œé€‚åˆå¿«é€ŸéªŒè¯ã€‚

```bash
sudo apt install ros-galactic-slam-toolbox
```

### 3. é…ç½®ä¼ æ„Ÿå™¨

ç¼–è¾‘ `config/slam_config.yaml`ï¼Œé…ç½®ä½ çš„ä¼ æ„Ÿå™¨è¯é¢˜ï¼š

```yaml
sensors:
  lidar:
    topic: "/velodyne_points"  # ä¿®æ”¹ä¸ºä½ çš„æ¿€å…‰é›·è¾¾è¯é¢˜

  camera:
    topic: "/camera/rgb/image_raw"  # ä¿®æ”¹ä¸ºä½ çš„ç›¸æœºè¯é¢˜

  imu:
    topic: "/imu/data"  # ä¿®æ”¹ä¸ºä½ çš„IMUè¯é¢˜
```

### 4. å¯åŠ¨SLAMé›†æˆ

#### æ–¹æ³•1: ä½¿ç”¨launchæ–‡ä»¶ï¼ˆæ¨èï¼‰

```bash
cd /media/yangyuhui/CODES1/Brain
source /opt/ros/galactic/setup.bash

# å¯åŠ¨SLAMé›†æˆ
ros2 launch slam_integration/launch/slam_integration.launch.py

# å¦ä¸€ä¸ªç»ˆç«¯ï¼šæŸ¥çœ‹RViz
rviz2 -d config/rviz2/slam_integration.rviz
```

#### æ–¹æ³•2: åˆ†åˆ«å¯åŠ¨å„èŠ‚ç‚¹

```bash
# ç»ˆç«¯1: å¯åŠ¨SLAMèŠ‚ç‚¹
ros2 run fast_livo fast_livo_node

# ç»ˆç«¯2: å¯åŠ¨è®¤çŸ¥å±‚
python -m brain.cognitive.world_model

# ç»ˆç«¯3: å¯åŠ¨RViz
rviz2
```

### 5. éªŒè¯SLAMé›†æˆ

```bash
# æŸ¥çœ‹è¯é¢˜
ros2 topic list | grep -E "(map|pose|path)"

# æŸ¥çœ‹åœ°å›¾
ros2 topic echo /map --once

# æŸ¥çœ‹ä½å§¿
ros2 topic echo /pose --once
```

---

## ğŸ’¡ ä½¿ç”¨ç¤ºä¾‹

### Pythonä»£ç ä¸­ä½¿ç”¨SLAM Manager

```python
import asyncio
from slam_integration.src import SLAMManager, SLAMConfig

async def main():
    # 1. åˆ›å»ºSLAMé…ç½®
    config = SLAMConfig(
        backend="fast_livo",
        resolution=0.1,
        zero_copy=True
    )

    # 2. åˆå§‹åŒ–SLAM Manager
    slam_manager = SLAMManager(config)

    # 3. ç­‰å¾…SLAMåœ°å›¾å°±ç»ª
    if await slam_manager.wait_for_map(timeout=10.0):
        print("SLAMåœ°å›¾å·²å°±ç»ªï¼")

        # 4. è·å–åœ°å›¾å…ƒæ•°æ®
        metadata = slam_manager.get_map_metadata()
        print(f"åœ°å›¾å°ºå¯¸: {metadata.width}x{metadata.height}")
        print(f"åˆ†è¾¨ç‡: {metadata.resolution}ç±³/æ …æ ¼")

        # 5. åæ ‡è½¬æ¢
        world_pos = (5.0, 3.0)  # ä¸–ç•Œåæ ‡ (ç±³)
        grid_pos = slam_manager.world_to_grid(world_pos)
        print(f"ä¸–ç•Œåæ ‡{world_pos} â†’ æ …æ ¼åæ ‡{grid_pos}")

        # 6. è·å–æœºå™¨äººä½ç½®
        robot_pos = slam_manager.get_robot_position()
        if robot_pos:
            x, y, yaw = robot_pos
            print(f"æœºå™¨äººä½ç½®: x={x:.2f}, y={y:.2f}, yaw={yaw:.2f}")
    else:
        print("SLAMåœ°å›¾è·å–è¶…æ—¶")

    # 7. æ¸…ç†
    slam_manager.shutdown()

if __name__ == "__main__":
    asyncio.run(main())
```

### åœ¨è®¤çŸ¥å±‚WorldModelä¸­é›†æˆSLAM

```python
from brain.cognitive.world_model import WorldModel
from slam_integration.src import SLAMManager, SLAMConfig

class EnhancedWorldModel(WorldModel):
    """
    å¢å¼ºçš„ä¸–ç•Œæ¨¡å‹ - é›†æˆSLAM
    """
    def __init__(self):
        super().__init__()

        # åˆå§‹åŒ–SLAM Manager
        config = SLAMConfig(zero_copy=True)
        self.slam_manager = SLAMManager(config)

        # ç§»é™¤ç‹¬ç«‹çš„å‡ ä½•åœ°å›¾ç®¡ç†
        # self.occupancy_grid = None  # âŒ ä¸å†ç»´æŠ¤

    async def update_from_slam(self):
        """ä»SLAMæ›´æ–°å‡ ä½•åœ°å›¾ï¼ˆé›¶æ‹·è´ï¼‰"""
        await self.slam_manager.wait_for_map(timeout=5.0)

        # é›¶æ‹·è´å¼•ç”¨SLAMåœ°å›¾
        slam_map = self.slam_manager.slam_map

        # å°†è¯­ä¹‰ä¿¡æ¯å åŠ åˆ°SLAMåœ°å›¾
        for obj_id, obj in self.semantic_objects.items():
            grid_pos = self.slam_manager.world_to_grid(obj.world_position)
            self.semantic_overlays[grid_pos] = obj

    def get_enhanced_map(self):
        """
        è·å–å¢å¼ºåœ°å›¾ï¼ˆå‡ ä½•+è¯­ä¹‰å åŠ ï¼‰
        """
        return EnhancedMap(
            geometric_layer=self.slam_manager.slam_map,  # SLAMåœ°å›¾å¼•ç”¨
            semantic_overlays=self.semantic_overlays,     # è¯­ä¹‰æ ‡æ³¨
            risk_areas=self.risk_areas                    # é£é™©æ ‡æ³¨
        )
```

---

## ğŸ“Š æ€§èƒ½æŒ‡æ ‡

| æŒ‡æ ‡ | ç›®æ ‡å€¼ | æµ‹é‡æ–¹æ³• |
|------|--------|----------|
| å®šä½ç²¾åº¦ | <10cm | æ¿€å…‰é›·è¾¾SLAM |
| åœ°å›¾æ›´æ–°é¢‘ç‡ | >5Hz | /mapè¯é¢˜å‘å¸ƒé¢‘ç‡ |
| é›¶æ‹·è´å»¶è¿Ÿ | <5ms | å†…å­˜è®¿é—®æ—¶é—´ |
| å†…å­˜å ç”¨ | ç¨³å®š | é•¿æ—¶é—´è¿è¡Œç›‘æ§ |

---

## ğŸ”§ æ•…éšœæ’æŸ¥

### é—®é¢˜1: ROS2èŠ‚ç‚¹æ— æ³•å¯åŠ¨

```bash
# æ£€æŸ¥ROS2ç¯å¢ƒ
echo $ROS_DISTRO

# é‡æ–°é…ç½®ç¯å¢ƒ
source /opt/ros/galactic/setup.bash
```

### é—®é¢˜2: æ‰¾ä¸åˆ°SLAMè¯é¢˜

```bash
# æ£€æŸ¥SLAMèŠ‚ç‚¹æ˜¯å¦è¿è¡Œ
ros2 node list

# æ£€æŸ¥è¯é¢˜åˆ—è¡¨
ros2 topic list

# æŸ¥çœ‹è¯é¢˜ç±»å‹
ros2 topic info /map
```

### é—®é¢˜3: åæ ‡è½¬æ¢å¤±è´¥

```bash
# æ£€æŸ¥TF2æ ‘
ros2 run tf2_tools view_frames

# æŸ¥çœ‹æ‰€æœ‰å˜æ¢
ros2 run tf2_ros tf2_echo map base_link
```

---

## ğŸ“š å‚è€ƒèµ„æ–™

- [FAST-LIVOè®ºæ–‡](https://arxiv.org/abs/2209.11145)
- [LIO-SAM GitHub](https://github.com/TIXIAO-SHAN/LIO-SAM)
- [ROS2å®˜æ–¹æ–‡æ¡£](https://docs.ros.org/en/galactic/)
- [Brainé¡¹ç›®æ¶æ„æ–‡æ¡£](../../docs/ARCHITECTURE.md)

---

## ğŸ“ TODO

- [ ] Phase 0: SLAMåç«¯å®‰è£…å’Œæµ‹è¯•
- [ ] Phase 0: ä¼ æ„Ÿå™¨æ ‡å®šå’Œé…ç½®
- [ ] Phase 1: WorldModelå‡ ä½•å±‚æ”¹é€ 
- [ ] Phase 1: è¯­ä¹‰å±‚å¢å¼º
- [ ] Phase 2: æ€§èƒ½ä¼˜åŒ–ï¼ˆå¢é‡æ›´æ–°ã€å†…å­˜ç®¡ç†ï¼‰
- [ ] Phase 3: æ¶æ„é‡æ„
- [ ] Phase 4: åŠŸèƒ½å¢å¼ºå’Œæµ‹è¯•

---

**ç»´æŠ¤è€…**: Brain Team
**æœ€åæ›´æ–°**: 2026-01-14
**ç‰ˆæœ¬**: 1.0.0
